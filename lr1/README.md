## Задание

Разработка патча для сетевого драйвера Beaglebone Black, обеспечивающего вывод в лог ядра следующей информации:

*   номер прерываний драйвера;
*   адрес (физический) области ввода-вывода;
*   размер области;
*   содержимое и размер данных входящих и исходящих пакетов.

Добавление патча в buildroot и его тестирование.

## Ход работы

1.  **Идентификация драйвера:**
    *   С помощью команды `ls -l /sys/class/net/eth0/device/driver` был определен драйвер, отвечающий за сеть, - `cpsw-switch`.

2.  **Модификация исходного кода ядра:**
    *   Найден файл `cpsw_new.c`, являющийся частью драйвера Ethernet.
    *   В файл `cpsw_new.c` добавлены отладочные сообщения `printk` для вывода информации о работе драйвера.
    *   Измененная версия файла сохранена как `cpsw_new_patched.c`.

3.  **Создание патча:**
    *   С помощью команды `diff -p cpsw_new.c cpsw_new_patched.c > cpsw_new.patch` создан патч, содержащий различия между оригинальным и модифицированным файлами.

4.  **Проверка логирования при загрузке:**
    *   После запуска Beaglebone Black, в логе ядра выведена следующая информация:
        ```
        [    0.504884] cpsw_probe called
        [    0.505096] IRQ rx number: 29 
        [    0.505167] IRQ tx number: 2a
        [    0.505225] IRQ misc number: 2b
        [    0.505334] IO region: 0, size: 4000
        ```
    *   Данные сообщения содержат номера прерываний (в шестнадцатеричной системе), физический адрес ввода-вывода и размер области.

5.  **Проверка информации с помощью Device Tree:**
    *   С помощью `dtc aam335x-boneblack.dtb -o am335x-boneblack.dts` получен читаемый файл Device Tree.
    *   Фрагмент Device Tree показывает соответствие выведенных ранее значений номеров прерываний, адреса и размера области:
        ```
        switch@0 {
            compatible = "ti,am335x-cpsw-switch\0ti,cpsw-switch";
            reg = <0x00 0x4000>;
            ranges = <0x00 0x00 0x4000>;
            ...
            interrupts = <0x28 0x29 0x2a 0x2b>;
            interrupt-names = "rx_thresh\0rx\0tx\0misc";
            ...
        }
        ```

6.  **Проверка логирования пакетов:**
    *   Для проверки логирования пакетов выполнены команды:
        ```
        echo auto eth0 >> /etc/network/interfaces
        echo iface eth0 inet dhcp >> /etc/network/interfaces
        ifup eth0
        ```
    *   После чего в логе ядра появилась информация о входящих и исходящих пакетах:
        ```
        [ 1033.843836] Outgoing packet cbf11fa0, size: 70
        [ 1034.078227] Incoming packet 43e59e1f, size: 46
        [ 1034.083323] Incoming packet a811e238, size: 46
        ```
